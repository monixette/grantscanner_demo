<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grant Scanner â€” Dashboard Â· Accountability Lab Mexico</title>
    <meta name="description"
        content="Grant intelligence pipeline for Accountability Lab Mexico. Real-time funder tracking, AI scoring, and proposal generation." />
    <link rel="stylesheet" href="shared.css" />
    <style>
        /* â”€â”€ Page-specific â”€â”€ */
        .priority-label {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: .5px;
            color: var(--accent);
            background: var(--accent-glow);
            border: 1px solid rgba(16, 185, 129, .25);
            border-radius: 6px;
            padding: 2px 8px;
        }

        .stat-change {
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 99px;
            margin-top: 4px;
            display: inline-block;
        }

        .stat-up {
            background: rgba(16, 185, 129, .12);
            color: var(--accent);
        }

        .stat-down {
            background: rgba(239, 68, 68, .1);
            color: var(--red);
        }

        .empty-state {
            padding: 48px 24px;
            text-align: center;
            color: var(--muted2);
            font-size: 14px;
        }

        .hero-cta {
            background: linear-gradient(135deg, rgba(16, 185, 129, .08), rgba(16, 185, 129, .02));
            border: 1px solid rgba(16, 185, 129, .2);
            border-radius: var(--radius);
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .results-count {
            font-size: 12px;
            color: var(--muted2);
            font-weight: 500;
            margin-left: auto;
        }

        .sort-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            background: var(--surface2);
            border-bottom: 1px solid var(--border);
        }

        .sort-btn {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 6px;
            color: var(--muted2);
            cursor: pointer;
            background: none;
            border: none;
            transition: all var(--transition);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .sort-btn:hover,
        .sort-btn.active {
            color: var(--accent);
        }

        .sort-btn.active::after {
            content: ' â†“';
        }

        .col-actions {
            width: 80px;
            text-align: right;
        }

        /* Row-level status indicator */
        .row-urgent td:first-child::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--accent);
        }

        .row-closed {
            opacity: .7;
        }
    </style>
</head>

<body>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NAVBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <a href="index.html" class="navbar-brand" aria-label="Grant Scanner home">
            <div class="brand-icon">GS</div>
            <div>
                <span class="brand-name">Grant Scanner</span>
                <span class="brand-org">Accountability Lab Mexico</span>
            </div>
        </a>

        <div class="navbar-links">
            <a href="index.html" class="nav-link active">ğŸ  Dashboard</a>
            <a href="#" class="nav-link">ğŸ“Š Pipeline</a>
            <a href="#" class="nav-link">ğŸ“„ Reports</a>
            <a href="#" class="nav-link">âš™ï¸ Settings</a>
        </div>

        <div class="navbar-actions">
            <span class="nav-badge">Mapeo 2026</span>
            <button class="theme-toggle" id="themeToggle" title="Toggle dark/light mode"
                aria-label="Toggle theme">ğŸŒ™</button>
        </div>

        <button class="burger" id="burgerBtn" aria-label="Open menu" aria-expanded="false">
            <span></span><span></span><span></span>
        </button>
    </nav>

    <!-- Mobile drawer -->
    <div class="mobile-drawer" id="mobileDrawer" role="navigation">
        <a href="index.html" class="mobile-nav-link active">ğŸ  Dashboard</a>
        <a href="#" class="mobile-nav-link">ğŸ“Š Pipeline</a>
        <a href="#" class="mobile-nav-link">ğŸ“„ Reports</a>
        <a href="#" class="mobile-nav-link">âš™ï¸ Settings</a>
        <div style="padding-top:8px;border-top:1px solid var(--border);">
            <button class="mobile-nav-link w-full" style="text-align:left;" onclick="toggleTheme()">
                <span id="mobileThemeLabel">ğŸŒ™ Switch to Light Mode</span>
            </button>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page-wrap">
        <div class="container">

            <!-- Header -->
            <div class="mb-20">
                <div class="label mb-8">Funder Intelligence Â· Feb 2026</div>
                <h1 class="page-title">Grant Dashboard</h1>
                <p class="page-sub">18 funders mapped Â· Real-time status Â· AI-powered alignment scores across the AL
                    Mexico pipeline</p>
            </div>

            <!-- KPI strip -->
            <div class="kpi-grid mb-28">
                <div class="kpi card-lift" style="--ac:var(--accent);">
                    <div class="kpi-icon">ğŸ”</div>
                    <div class="kpi-val text-accent" id="kpi1">0</div>
                    <div class="kpi-lbl">Funders Mapped</div>
                    <div class="stat-change stat-up">â†‘ 3 this month</div>
                </div>
                <div class="kpi card-lift" style="--ac:var(--gold);">
                    <div class="kpi-icon">âš¡</div>
                    <div class="kpi-val text-gold" id="kpi2">0</div>
                    <div class="kpi-lbl">Open / Active</div>
                    <div class="stat-change stat-up">Verified today</div>
                </div>
                <div class="kpi card-lift" style="--ac:var(--purple);">
                    <div class="kpi-icon">ğŸ“</div>
                    <div class="kpi-val" style="color:var(--purple);" id="kpi3">0</div>
                    <div class="kpi-lbl">In Progress</div>
                    <div class="stat-change stat-up">â†‘ 1 new</div>
                </div>
                <div class="kpi card-lift" style="--ac:var(--accent);">
                    <div class="kpi-icon">ğŸ†</div>
                    <div class="kpi-val text-accent" id="kpi4">0</div>
                    <div class="kpi-lbl">Submitted Q1 2026</div>
                    <div class="stat-change stat-up">2 awaiting decision</div>
                </div>
            </div>

            <!-- Hero CTA (Priority Action) -->
            <div class="hero-cta mb-20" id="heroCta">
                <div>
                    <div class="flex items-center gap-8 mb-8">
                        <span class="badge badge-urgent">âš¡ Prioridad Inmediata</span>
                        <span class="text-xs text-muted">Score 72/100 Â· Verificado Feb 28, 2026 Â· 27 dÃ­as al
                            cierre</span>
                    </div>
                    <div class="font-bold mb-4" style="font-size:16px;">FundaciÃ³n Merced IDEAS 2026 â€” Convocatoria
                        abierta hasta 27 marzo</div>
                    <div class="text-sm text-muted">Democracia Â· CiudadanÃ­a Â· Juventudes Â· OSC MÃ©xico Â· Donataria
                        requerida Â· <strong style="color:var(--accent);">AcciÃ³n recomendada: aplicar ahora</strong>
                    </div>
                </div>
                <a href="grant.html" class="btn btn-primary btn-lg" style="white-space:nowrap;">
                    Review &amp; Apply â†’
                </a>
            </div>

            <!-- â”€â”€ FILTER BAR â”€â”€ -->
            <div class="filter-section mb-8">

                <!-- Row 1: Search + quick status -->
                <div class="filter-row mb-12">
                    <input type="text" class="search-input" id="searchInput" placeholder="ğŸ”  Search fundersâ€¦"
                        oninput="applyFilters()" />

                    <div class="filter-divider"></div>

                    <div class="filter-pills" id="statusPills">
                        <button class="filter-pill active" data-filter-status="all"
                            onclick="setStatus(this)">All</button>
                        <button class="filter-pill" data-filter-status="open" onclick="setStatus(this)">âš¡ Open</button>
                        <button class="filter-pill" data-filter-status="closed" onclick="setStatus(this)">âœ•
                            Closed</button>
                        <button class="filter-pill" data-filter-status="invite" onclick="setStatus(this)">ğŸ”’ By
                            Invitation</button>
                        <button class="filter-pill" data-filter-status="watch" onclick="setStatus(this)">ğŸ‘
                            Monitoring</button>
                    </div>

                    <span class="results-count" id="resultsCount"></span>
                </div>

                <!-- Row 2: secondary filters -->
                <div class="filter-row">
                    <span class="filter-label-sm">Alignment:</span>
                    <div class="filter-pills" id="alignPills">
                        <button class="filter-pill active" data-filter-align="all" onclick="setAlign(this)">All</button>
                        <button class="filter-pill" data-filter-align="high" onclick="setAlign(this)">ğŸŸ¢ High</button>
                        <button class="filter-pill" data-filter-align="medium" onclick="setAlign(this)">ğŸŸ¡
                            Medium</button>
                        <button class="filter-pill" data-filter-align="low" onclick="setAlign(this)">ğŸ”´ Low</button>
                    </div>

                    <div class="filter-divider"></div>

                    <span class="filter-label-sm">Region:</span>
                    <select class="filter-select" id="regionSelect" onchange="applyFilters()">
                        <option value="all">All regions</option>
                        <option value="mexico">ğŸ‡²ğŸ‡½ Mexico</option>
                        <option value="latam">ğŸŒ LATAM</option>
                        <option value="global">ğŸŒ Global</option>
                    </select>

                    <div class="filter-divider"></div>

                    <span class="filter-label-sm">Sort:</span>
                    <select class="filter-select" id="sortSelect" onchange="applyFilters()">
                        <option value="score">Score â†“</option>
                        <option value="deadline">Deadline â†‘</option>
                        <option value="name">Name Aâ€“Z</option>
                    </select>

                    <button class="btn btn-ghost" style="padding:5px 12px;font-size:12px;" onclick="resetFilters()">âœ•
                        Reset</button>
                </div>
            </div>

            <!-- â”€â”€ GRANTS TABLE â”€â”€ -->
            <div class="grant-table-wrap">

                <!-- Sort row (desktop only) -->
                <div class="sort-row" style="display:none;" id="sortRowDesk">
                    <!-- shown programmatically on desktop -->
                </div>

                <table class="grant-table" id="grantsTable" aria-label="Grant opportunities">
                    <thead>
                        <tr>
                            <th style="width:14px;"></th>
                            <th>Funder / Programme</th>
                            <th>Region</th>
                            <th>Cycle &amp; Deadline</th>
                            <th>Grant Range</th>
                            <th>
                                <span class="with-tooltip">Score
                                    <span class="tooltip">AI-calculated affinity score (0â€“100) based on mission
                                        alignment, geography, org type, financial viability, timeline, capacity, shared
                                        values, and risk factors.</span>
                                </span>
                            </th>
                            <th>Status</th>
                            <th class="col-actions"></th>
                        </tr>
                    </thead>
                    <tbody id="grantsBody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>

                <!-- Empty state -->
                <div class="empty-state" id="emptyState" style="display:none;">
                    <div style="font-size:32px;margin-bottom:12px;">ğŸ”</div>
                    <div class="font-bold mb-8">No grants match your filters</div>
                    <div class="text-muted" style="font-size:13px;">Try adjusting the status, alignment, or region
                        filters above.</div>
                    <button class="btn btn-ghost mt-16" onclick="resetFilters()" style="margin:12px auto 0;">Reset
                        filters</button>
                </div>

            </div>

            <!-- (Hero CTA moved above filter bar) -->

        </div><!-- /container -->
    </div><!-- /page-wrap -->

    <!-- â”€â”€ BOTTOM BAR â”€â”€ -->
    <div class="bottom-bar">
        <div class="bottom-steps" aria-label="Pipeline progress">
            <div class="bottom-dot active" title="Step 1: Dashboard"></div>
            <div class="bottom-dot" title="Step 2: Grant Detail"></div>
            <div class="bottom-dot" title="Step 3: Score Report"></div>
            <div class="bottom-dot" title="Step 4: Decision"></div>
            <div class="bottom-dot" title="Step 5: Generating"></div>
            <div class="bottom-dot" title="Step 6: Output"></div>
        </div>
        <span class="text-sm text-muted">Step 1 of 6 â€” Dashboard</span>
        <a href="grant.html" class="btn btn-primary">
            Open Priority Grant â†’
        </a>
    </div>

    <!-- â”€â”€ HOVER CARD (floating, shared) â”€â”€ -->
    <div class="hover-card" id="hoverCard" role="tooltip" aria-live="polite"></div>

    <script>
        /* ====================================================
           GRANT SCANNER â€” Dashboard JS
           ==================================================== */

        /* â”€â”€ Data â”€â”€ */
        const GRANTS = [
            {
                id: 1, name: "FundaciÃ³n Merced Â· IDEAS 2026",
                sub: "Democracia, ciudadanÃ­a, juventudes Â· OSC MÃ©xico",
                region: "mexico", regionLabel: "ğŸ‡²ğŸ‡½ MÃ©xico",
                align: "high", score: 72,
                status: "open", statusLabel: "âš¡ Abierto Ahora", statusClass: "badge-urgent",
                deadline: "27 mar 2026", deadlineDate: "2026-03-27",
                amount: "TBD", priority: true,
                contact: "fundacionmerced.org.mx/ideas2026",
                note: "Donataria requerida Â· Cierra 27/03/2026 23:30 CDMX",
                link: "grant.html"
            },
            {
                id: 2, name: "EU-LAC Global Gateway Â· Social Accelerator",
                sub: "CAINCO Â· InnovaciÃ³n social Â· Consorcio requerido",
                region: "latam", regionLabel: "ğŸŒ LAC",
                align: "high", score: 71,
                status: "open", statusLabel: "âš¡ Registro Activo", statusClass: "badge-open",
                deadline: "Abierto", deadlineDate: "2026-12-31",
                amount: "â‚¬100K â€“ â‚¬250K", priority: false,
                contact: "eulacsocialaccelerator.cainco.org.bo",
                note: "Consorcio multi-paÃ­s Â· 18â€“24 meses",
                link: "#"
            },
            {
                id: 3, name: "UNESCO-Aschberg Programme 2025",
                sub: "Artists & Cultural Professionals Â· Track 2 CSO",
                region: "latam", regionLabel: "ğŸŒ Global",
                align: "high", score: 78,
                status: "closed", statusLabel: "Cerrado", statusClass: "badge-closed",
                deadline: "Feb 23, 2026", deadlineDate: "2026-02-23",
                amount: "up to $50K", priority: false,
                contact: "aschberg@unesco.org",
                note: "Deadline pasÃ³ Â· Preparar para prÃ³ximo ciclo",
                link: "#"
            },
            {
                id: 4, name: "Fondo CanadÃ¡ para Iniciativas Locales Â· CFLI",
                sub: "Embajada de CanadÃ¡ Â· Gobernanza inclusiva Â· GÃ©nero",
                region: "mexico", regionLabel: "ğŸ‡²ğŸ‡½ MÃ©xico",
                align: "high", score: 68,
                status: "watch", statusLabel: "Monitoring", statusClass: "badge-monitor",
                deadline: "May 2026 (est.)", deadlineDate: "2026-05-01",
                amount: "~CAD 45K", priority: false,
                contact: "Gabriela de la PeÃ±a Â· LinkedIn",
                note: "Ciclo anual Â· Esperado mayo 2026 Â· CLOSED 2025",
                link: "#"
            },
            {
                id: 5, name: "Tinker Foundation Â· Democratic Governance",
                sub: "Justicia y gobernanza democrÃ¡tica Â· LATAM",
                region: "latam", regionLabel: "ğŸŒ LATAM",
                align: "medium", score: 65,
                status: "closed", statusLabel: "LOI Cerrado", statusClass: "badge-closed",
                deadline: "Jan 21, 2026", deadlineDate: "2026-01-21",
                amount: "$50K â€“ $150K", priority: false,
                contact: "Caroline Kronley Â· ckronley@tinker.org",
                note: "LOI cerrado Â· Full proposal invitados Â· DecisiÃ³n Jun 2026",
                link: "#"
            },
            {
                id: 6, name: "Alianza SURGE Â· FAM / FCP",
                sub: "Espacio cÃ­vico Â· Democracia desde la base Â· MÃ©xico",
                region: "mexico", regionLabel: "ğŸ‡²ğŸ‡½ MÃ©xico",
                align: "high", score: 62,
                status: "invite", statusLabel: "Por RecomendaciÃ³n", statusClass: "badge-invite",
                deadline: "2026 via Avina", deadlineDate: "2026-12-31",
                amount: "up to $30K", priority: false,
                contact: "Fortalecer rel. con Avina",
                note: "2026 applications through recommendation only",
                link: "#"
            },
            {
                id: 7, name: "People Powered Â· Accelerators",
                sub: "Democracia participativa Â· Digital Â· Clima",
                region: "latam", regionLabel: "ğŸŒ Global",
                align: "medium", score: 58,
                status: "closed", statusLabel: "Cerrado Dec 2025", statusClass: "badge-closed",
                deadline: "Dec 8, 2025", deadlineDate: "2025-12-08",
                amount: "up to $25K", priority: false,
                contact: "peoplepowered.org/accelerators",
                note: "Aplicaciones cerradas Â· Monitorear prÃ³ximo ciclo",
                link: "#"
            },
            {
                id: 8, name: "Open Society Foundations",
                sub: "Derechos humanos Â· Buen Vivir Â· Mostly invitation-driven",
                region: "global", regionLabel: "ğŸŒ Global + LATAM",
                align: "medium", score: 55,
                status: "invite", statusLabel: "Por InvitaciÃ³n", statusClass: "badge-invite",
                deadline: "Continuo", deadlineDate: "2026-12-31",
                amount: "$60K â€“ $700K+", priority: false,
                contact: "latinamerica@opensocietyfoundations.org",
                note: "MayorÃ­a invitaciÃ³n directa Â· AL Global recibiÃ³ $60K (2024)",
                link: "#"
            },
            {
                id: 9, name: "NORAD Â· Norwegian Agency for Development",
                sub: "Gobernanza Â· GÃ©nero Â· Derechos humanos",
                region: "global", regionLabel: "ğŸŒ Global",
                align: "medium", score: 54,
                status: "invite", statusLabel: "Sin Convocatoria", statusClass: "badge-invite",
                deadline: "Relationship", deadlineDate: "2026-12-31",
                amount: "$50K â€“ $300K", priority: false,
                contact: "norad.no/en",
                note: "No open call Â· Access via relationship",
                link: "#"
            },
            {
                id: 10, name: "Bloomberg Philanthropies",
                sub: "Government Innovation Â· Artes Â· Salud pÃºblica",
                region: "global", regionLabel: "ğŸŒ Global",
                align: "medium", score: 51,
                status: "invite", statusLabel: "Por InvitaciÃ³n", statusClass: "badge-invite",
                deadline: "No open calls", deadlineDate: "2026-12-31",
                amount: "~$50K", priority: false,
                contact: "bloomberg.org",
                note: "Invitation-only Â· Sin convocatoria abierta",
                link: "#"
            },
            {
                id: 11, name: "Panta Rhea Foundation",
                sub: "Justicia climÃ¡tica Â· Narrativas Â· Comunidades Afro/IndÃ­genas",
                region: "latam", regionLabel: "ğŸŒ AmÃ©ricas",
                align: "medium", score: 50,
                status: "invite", statusLabel: "Por InvitaciÃ³n", statusClass: "badge-invite",
                deadline: "Mostly OS support", deadlineDate: "2026-12-31",
                amount: "$1,500 â€“ $400K", priority: false,
                contact: "pantarhea.org",
                note: "Family fdn Â· Multi-year OS support Â· Invitation",
                link: "#"
            },
            {
                id: 12, name: "FIDC Â· Fondo Internacional Diversidad Cultural",
                sub: "UNESCO Â· Diversidad cultural Â· PolÃ­ticas culturales",
                region: "global", regionLabel: "ğŸŒ Global",
                align: "medium", score: 48,
                status: "closed", statusLabel: "Cerrado 2025", statusClass: "badge-closed",
                deadline: "May 2025 (pasado)", deadlineDate: "2025-05-21",
                amount: "TBD", priority: false,
                contact: "unesco.org/creativity",
                note: "Next cycle: Marâ€“May 2026 est.",
                link: "#"
            },
            {
                id: 13, name: "IKI Â· Iniciativa Internacional de Clima (BMZ)",
                sub: "Clima Â· Biodiversidad Â· Small Grants OSC locales",
                region: "global", regionLabel: "ğŸŒ Global",
                align: "medium", score: 44,
                status: "closed", statusLabel: "Cerrado Ene 2026", statusClass: "badge-closed",
                deadline: "Jan 15, 2026", deadlineDate: "2026-01-15",
                amount: "â‚¬60K â€“ â‚¬20M", priority: false,
                contact: "international-climate-initiative.com",
                note: "Closed Â· Annual competitive calls Â· Large: Feb 17 2026",
                link: "#"
            },
            {
                id: 14, name: "MacArthur Foundation",
                sub: "Sistemas de cambio Â· US/Nigeria/India focus",
                region: "global", regionLabel: "ğŸŒ Global",
                align: "low", score: 38,
                status: "invite", statusLabel: "Sin Convocatoria", statusClass: "badge-closed",
                deadline: "No open call", deadlineDate: "2026-12-31",
                amount: "Large grants", priority: false,
                contact: "macfound.fluxx.io/lois",
                note: "Past MX work ended 2020 Â· No local presence Â· LOI invitation only",
                link: "#"
            },
            {
                id: 15, name: "PACMyC 2026 Â· SecretarÃ­a de Cultura",
                sub: "Culturas populares Â· Patrimonio vivo Â· MÃ©xico",
                region: "mexico", regionLabel: "ğŸ‡²ğŸ‡½ MÃ©xico",
                align: "low", score: 22,
                status: "open", statusLabel: "Abierto", statusClass: "badge-open",
                deadline: "29 abr 2026", deadlineDate: "2026-04-29",
                amount: "TBD", priority: false,
                contact: "convocatorias.cultura.gob.mx",
                note: "âš ï¸ No alineado con misiÃ³n AL Â· grupos portadores culturales",
                link: "#"
            }
        ];

        /* â”€â”€ State â”€â”€ */
        let activeStatus = "all";
        let activeAlign = "all";
        let activeRegion = "all";
        let activeSearch = "";
        let activeSort = "score";

        /* â”€â”€ Init â”€â”€ */
        document.addEventListener('DOMContentLoaded', () => {
            animateKPIs();
            applyFilters();
            initTheme();
        });

        /* â”€â”€ Animate KPIs â”€â”€ */
        function animateKPIs() {
            const targets = [18, 4, 3, 2];
            const ids = ['kpi1', 'kpi2', 'kpi3', 'kpi4'];
            ids.forEach((id, i) => {
                let n = 0, target = targets[i];
                const el = document.getElementById(id);
                const step = () => {
                    n = Math.min(n + 1, target);
                    el.textContent = n;
                    if (n < target) requestAnimationFrame(step);
                };
                setTimeout(() => requestAnimationFrame(step), i * 150);
            });
        }

        /* â”€â”€ Filter logic â”€â”€ */
        function setStatus(btn) {
            document.querySelectorAll('[data-filter-status]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            activeStatus = btn.dataset.filterStatus;
            applyFilters();
        }
        function setAlign(btn) {
            document.querySelectorAll('[data-filter-align]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            activeAlign = btn.dataset.filterAlign;
            applyFilters();
        }
        function resetFilters() {
            activeStatus = 'all'; activeAlign = 'all'; activeRegion = 'all';
            activeSearch = ''; activeSort = 'score';
            document.querySelectorAll('[data-filter-status]').forEach(b => b.classList.toggle('active', b.dataset.filterStatus === 'all'));
            document.querySelectorAll('[data-filter-align]').forEach(b => b.classList.toggle('active', b.dataset.filterAlign === 'all'));
            document.getElementById('regionSelect').value = 'all';
            document.getElementById('sortSelect').value = 'score';
            document.getElementById('searchInput').value = '';
            applyFilters();
        }
        function applyFilters() {
            activeSearch = document.getElementById('searchInput').value.toLowerCase();
            activeRegion = document.getElementById('regionSelect').value;
            activeSort = document.getElementById('sortSelect').value;

            let filtered = GRANTS.filter(g => {
                if (activeStatus !== 'all' && g.status !== activeStatus) return false;
                if (activeAlign !== 'all' && g.align !== activeAlign) return false;
                if (activeRegion !== 'all' && g.region !== activeRegion) return false;
                if (activeSearch && !g.name.toLowerCase().includes(activeSearch)
                    && !g.sub.toLowerCase().includes(activeSearch)) return false;
                return true;
            });

            // Sort
            filtered.sort((a, b) => {
                if (activeSort === 'score') return b.score - a.score;
                if (activeSort === 'deadline') return new Date(a.deadlineDate) - new Date(b.deadlineDate);
                if (activeSort === 'name') return a.name.localeCompare(b.name);
                return 0;
            });

            renderGrants(filtered);
            document.getElementById('resultsCount').textContent = `${filtered.length} results`;

            // Empty state
            document.getElementById('emptyState').style.display = filtered.length ? 'none' : 'block';
        }

        /* â”€â”€ Render â”€â”€ */
        function renderGrants(list) {
            const tbody = document.getElementById('grantsBody');
            const alignDot = { high: 'dot-high', medium: 'dot-medium', low: 'dot-low' };
            const scoreCls = s => s >= 65 ? 'score-high' : s >= 45 ? 'score-mid' : 'score-low';
            let html = '';
            let lastPriority = null;

            list.forEach((g, i) => {
                // Section labels
                if (i === 0 && g.priority) {
                    html += `<tr class="table-section-row"><td colspan="8">âš¡ Priority Â· Active Calls</td></tr>`;
                }
                if (i > 0 && !g.priority && list[i - 1].priority) {
                    html += `<tr class="table-section-row"><td colspan="8">All Funders</td></tr>`;
                }
                if (i === 0 && !g.priority) {
                    html += `<tr class="table-section-row"><td colspan="8">All Funders Â· Filtered Results</td></tr>`;
                }

                const rowCls = [
                    g.priority ? 'priority-row row-urgent' : '',
                    g.status === 'closed' ? 'row-closed' : ''
                ].join(' ');

                html += `
      <tr class="${rowCls}"
          data-id="${g.id}"
          onmouseenter="showHover(event, ${g.id})"
          onmouseleave="hideHover()"
          onclick="window.location='${g.link}'"
          style="cursor:${g.link !== '#' ? 'pointer' : 'default'}">
        <td style="position:relative;"><span class="align-dot ${alignDot[g.align]}"></span></td>
        <td>
          <div class="grant-name-cell">${g.priority ? '<span style="color:var(--accent)">â­ </span>' : ''}${g.name}</div>
          <div class="grant-sub-cell">${g.sub}</div>
        </td>
        <td><span class="tag" style="font-size:11px;">${g.regionLabel}</span></td>
        <td>
          <span class="badge ${g.statusClass}" style="font-size:10px;">${g.statusLabel}</span>
          <div style="font-size:11px;color:var(--muted2);margin-top:4px;">${g.deadline}</div>
        </td>
        <td style="font-weight:700;color:${g.status === 'open' ? 'var(--accent)' : 'var(--muted2)'};font-size:13px;">${g.amount}</td>
        <td>
          <span class="score-pill ${scoreCls(g.score)} with-tooltip">
            ${g.score}
            <span class="tooltip">Affinity score based on mission alignment, geography, org type, financial viability, timeline, capacity, shared values, and risk. Learn more in the Score Report.</span>
          </span>
        </td>
        <td>
          <span class="badge ${g.statusClass}">${g.statusLabel}</span>
        </td>
        <td class="col-actions" onclick="event.stopPropagation()">
          ${g.link !== '#' ? `<a href="${g.link}" class="btn btn-ghost" style="padding:6px 12px;font-size:11px;">Open â†’</a>` : ''}
        </td>
      </tr>`;
            });

            tbody.innerHTML = html;
        }

        /* â”€â”€ Hover card â”€â”€ */
        const hoverCard = document.getElementById('hoverCard');
        let hoverTimeout;
        function showHover(e, id) {
            hoverTimeout = setTimeout(() => {
                const g = GRANTS.find(x => x.id === id);
                if (!g) return;
                const alignColor = { high: 'var(--accent)', medium: 'var(--gold)', low: 'var(--red)' };
                hoverCard.innerHTML = `
        <div class="hc-title">${g.name}</div>
        <div style="font-size:11px;color:var(--muted2);margin-bottom:10px;">${g.sub}</div>
        <div class="hc-row"><span class="hc-key">Alignment</span><span class="hc-val" style="color:${alignColor[g.align]}">${g.align.toUpperCase()}</span></div>
        <div class="hc-row"><span class="hc-key">Score</span><span class="hc-val">${g.score}/100</span></div>
        <div class="hc-row"><span class="hc-key">Amount</span><span class="hc-val">${g.amount}</span></div>
        <div class="hc-row"><span class="hc-key">Deadline</span><span class="hc-val">${g.deadline}</span></div>
        <div style="font-size:11px;color:var(--muted2);margin-top:8px;padding-top:8px;border-top:1px solid var(--border);">${g.note}</div>
      `;
                // Position
                const x = Math.min(e.clientX + 20, window.innerWidth - 300);
                const y = Math.min(e.clientY - 20, window.innerHeight - 200);
                hoverCard.style.left = x + 'px';
                hoverCard.style.top = y + 'px';
                hoverCard.classList.add('visible');
            }, 300);
        }
        function hideHover() {
            clearTimeout(hoverTimeout);
            hoverCard.classList.remove('visible');
        }

        /* Theme handled by app.js */

        /* â”€â”€ Burger â”€â”€ */
        const burgerBtn = document.getElementById('burgerBtn');
        const mobileDrawer = document.getElementById('mobileDrawer');
        burgerBtn.addEventListener('click', () => {
            const open = mobileDrawer.classList.toggle('open');
            burgerBtn.setAttribute('aria-expanded', open);
            burgerBtn.querySelectorAll('span').forEach((s, i) => {
                if (open) {
                    if (i === 0) s.style.transform = 'translateY(7px) rotate(45deg)';
                    if (i === 1) s.style.opacity = '0';
                    if (i === 2) s.style.transform = 'translateY(-7px) rotate(-45deg)';
                } else {
                    s.style.transform = ''; s.style.opacity = '';
                }
            });
        });
        // Close drawer on outside click
        document.addEventListener('click', (e) => {
            if (!burgerBtn.contains(e.target) && !mobileDrawer.contains(e.target)) {
                mobileDrawer.classList.remove('open');
                burgerBtn.setAttribute('aria-expanded', false);
                burgerBtn.querySelectorAll('span').forEach(s => { s.style.transform = ''; s.style.opacity = ''; });
            }
        });
    </script>

</body>

</html>